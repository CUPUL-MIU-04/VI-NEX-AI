name: Deploy VI-NEX-AI to Render

on:
  push:
    branches: [ main, master ]

jobs:
  test-and-deploy:
    runs-on: ubuntu-latest
    environment: production
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
        
    - name: Install dependencies
      run: |
        pip install -r requirements.txt
        pip install fastapi uvicorn python-multipart
        
    - name: Run tests
      run: |
        # Aqu√≠ tus comandos de test
        echo "Running tests..."
        
    - name: Deploy to Render using Deploy Hook
      env:
        DEPLOY_HOOK_URL: ${{ secrets.DEPLOY_URL }}
      run: |
        echo "üöÄ Desplegando VI-NEX-AI en Render..."
        echo "Deploy Hook URL: $([ ! -z "$DEPLOY_HOOK_URL" ] && echo "‚úÖ Configurada" || echo "‚ùå No configurada")"
        
        if [ -z "$DEPLOY_HOOK_URL" ]; then
          echo "‚ùå ERROR: DEPLOY_URL no configurada"
          echo "üìù Configura el secret DEPLOY_URL con el Deploy Hook de Render:"
          echo "1. Ve a tu servicio en Render"
          echo "2. Settings ‚Üí Deploy Hook"
          echo "3. Copia la URL del Deploy Hook"
          echo "4. Agr√©galo en GitHub Secrets como DEPLOY_URL"
          exit 1
        fi
        
        echo "‚úÖ Triggering deployment via Deploy Hook..."
        curl -X POST "$DEPLOY_HOOK_URL"
        echo "üéâ ¬°Deploy triggered! Verifica el progreso en https://dashboard.render.com/"
